# よくある質問（管理者向け）

## ユーザー管理

### Q: ユーザーを追加するには？

A:
1. 「管理」タブを開く
2. 「ユーザー追加」ボタンをクリック
3. 必要な情報を入力（名前、メール、ロール、申請タイプ）
4. 「作成」をクリック

### Q: ユーザーのロールを変更するには？

A:
1. 「管理」タブでユーザーを選択
2. 「編集」をクリック
3. ロールを変更
4. 「保存」をクリック

### Q: ユーザーを削除できますか？

A: 削除機能はありません。代わりに「無効化」してください。無効化されたユーザーはログインできなくなります。

### Q: 無効化されたユーザーを復活させるには？

A:
1. 「管理」タブでユーザーを選択
2. 「有効にする」をクリック
3. 確認して実行

### Q: メールアドレスが重複している場合は？

A: メールアドレスは一意である必要があります。既存のユーザーのメールアドレスを変更するか、新しいメールアドレスを使用してください。

## 承認業務

### Q: 承認待ちの申請を確認するには？

A: 「承認」タブ → 「承認待ち」タブで確認できます。

### Q: 変更承認の「変更理由」は必須ですか？

A: Fix タイプの変更承認では、変更理由の入力が必須です。Flex タイプでは任意です。

### Q: 承認済みの申請を取り消すには？

A:
1. 「承認」タブで申請を選択
2. 「取り消し」を選択
3. 取り消し理由を入力
4. 確認して実行

### Q: 代理で申請を作成するには？

A:
1. 「代理」タブを開く
2. 対象スタッフを選択
3. 申請内容を入力
4. 「作成」をクリック

代理申請は即座に「承認済み」として作成されます。

## システム設定

### Q: 初回管理者はどうやって作成されますか？

A: 環境変数 `FIRST_ADMIN_EMAIL` で指定されたメールアドレスで初めてログインすると、自動的に管理者として登録されます。これはシステムが初期状態（ユーザー0人）の場合のみ有効です。

### Q: レビュワーを追加するには？

A: ユーザー追加時または編集時に、ロールを「reviewer」に設定してください。

### Q: 環境変数を変更するには？

A: Vercel Dashboard → Settings → Environment Variables で変更できます。変更後は再デプロイが必要です。

## セキュリティ

### Q: 不正アクセスを検知するには？

A: Supabase Dashboard の Auth → Logs でログイン履歴を確認できます。異常なアクセスパターンがないか定期的に確認してください。

### Q: ユーザーを即座に無効化するには？

A:
1. 「管理」タブでユーザーを選択
2. 「無効にする」をクリック
3. 確認して実行

無効化されたユーザーは即座にログインできなくなります。

### Q: データのバックアップは取れていますか？

A: Supabase により自動バックアップが取られています。手動バックアップも可能です。詳細は[バックアップ](../10-operations/02-backup.md)を参照してください。

## トラブルシューティング

### Q: ユーザーがログインできないと報告された

A:
1. アカウントが存在するか確認
2. アカウントが有効か確認
3. メールアドレスが正しいか確認
4. Supabase の Auth ログを確認

### Q: 申請が重複して作成された

A: 通常、システムは重複申請を防止します。問題が発生した場合は、データベースを直接確認し、不要なレコードを削除してください。

### Q: システムのパフォーマンスが低下している

A:
1. Supabase Dashboard でデータベースの状態を確認
2. インデックスが適切に設定されているか確認
3. 大量のデータがある場合はアーカイブを検討

## 運用

### Q: 定期メンテナンスは必要ですか？

A: 基本的には自動で運用されますが、以下を定期的に実施することを推奨します：
- ユーザーアカウントの棚卸し（四半期）
- バックアップの検証（月次）
- 依存関係の更新（月次）

### Q: 監査ログはありますか？

A: すべての申請操作は `shift_request_histories` テーブルに記録されます。また、Supabase の各種ログも利用可能です。

### Q: システムの使用状況を確認するには？

A: 
- Vercel Dashboard → Analytics
- Supabase Dashboard → Usage

## 関連ドキュメント

- [ユーザー管理](../03-features/03-admin-management.md)
- [シフト承認](../03-features/02-reviewer-approval.md)
- [監視・ログ](../10-operations/01-monitoring.md)
