# ユーザー管理（管理者向け）

## 概要

管理者（admin）は、システムのユーザーを管理できます。ユーザーの追加、編集、有効/無効の切り替えが可能です。

## 管理画面

### アクセス

1. ナビゲーションの「管理」タブをタップ
2. `/admin` 画面が表示される

※ 管理者ロールのユーザーのみアクセス可能

### 画面構成

```
┌─────────────────────────────┐
│ ユーザー管理                 │
├─────────────────────────────┤
│      ［ ユーザー追加 ］      │
├─────────────────────────────┤
│ ┌─────────────────────────┐ │
│ │ 田中太郎                 │ │
│ │ tanaka@example.com      │ │
│ │ staff / fix / 有効       │ │
│ └─────────────────────────┘ │
│ ┌─────────────────────────┐ │
│ │ 鈴木一郎                 │ │
│ │ suzuki@example.com      │ │
│ │ reviewer / fix / 有効    │ │
│ └─────────────────────────┘ │
│ ┌─────────────────────────┐ │
│ │ 山田花子                 │ │
│ │ yamada@example.com      │ │
│ │ staff / flex / 無効      │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

## ユーザー追加

### 手順

1. 「ユーザー追加」ボタンをタップ
2. ユーザー情報を入力
3. 「作成」をタップ

### 入力項目

| 項目 | 必須 | 説明 |
|------|:----:|------|
| 名前 | ✅ | ユーザーの表示名 |
| メールアドレス | ✅ | ログイン用メールアドレス（一意） |
| ロール | ✅ | staff / reviewer / admin |
| 申請タイプ | ✅ | fix / flex |

### 追加フォーム

```
┌─────────────────────────────┐
│ ユーザー追加                 │
├─────────────────────────────┤
│ 名前                        │
│ ┌─────────────────────────┐ │
│ │ 山本次郎                  │ │
│ └─────────────────────────┘ │
│                             │
│ メールアドレス               │
│ ┌─────────────────────────┐ │
│ │ yamamoto@example.com     │ │
│ └─────────────────────────┘ │
│                             │
│ ロール                      │
│ ○ スタッフ  ○ レビュワー  ○ 管理者 │
│                             │
│ 申請タイプ                   │
│ ○ Fix（固定）  ○ Flex（フレックス） │
│                             │
│  ［ キャンセル ］ ［ 作成 ］  │
└─────────────────────────────┘
```

### 作成後

- ユーザーは入力されたメールアドレスでログイン可能
- 初回ログイン時にマジックリンクでセッション開始

## ユーザー編集

### 手順

1. 編集したいユーザーをタップ
2. 「編集」をタップ
3. 情報を変更
4. 「保存」をタップ

### 編集可能項目

| 項目 | 編集可否 | 注意点 |
|------|:--------:|--------|
| 名前 | ✅ | - |
| メールアドレス | ✅ | 一意性を確認 |
| ロール | ✅ | 権限の変更に注意 |
| 申請タイプ | ✅ | 既存申請には影響なし |

### 編集フォーム

```
┌─────────────────────────────┐
│ ユーザー編集                 │
├─────────────────────────────┤
│ 名前                        │
│ ┌─────────────────────────┐ │
│ │ 田中太郎                  │ │
│ └─────────────────────────┘ │
│                             │
│ メールアドレス               │
│ ┌─────────────────────────┐ │
│ │ tanaka@example.com       │ │
│ └─────────────────────────┘ │
│                             │
│ ロール                      │
│ ● スタッフ  ○ レビュワー  ○ 管理者 │
│                             │
│ 申請タイプ                   │
│ ● Fix（固定）  ○ Flex（フレックス） │
│                             │
│  ［ キャンセル ］ ［ 保存 ］  │
└─────────────────────────────┘
```

## 有効/無効の切り替え

### 有効化

無効なユーザーを有効にします。

1. 対象ユーザーをタップ
2. 「有効にする」をタップ
3. 確認して実行

### 無効化

有効なユーザーを無効にします。

1. 対象ユーザーをタップ
2. 「無効にする」をタップ
3. 確認して実行

### 無効化の影響

| 影響 | 説明 |
|------|------|
| ログイン | 不可（既存セッションも終了） |
| 既存申請 | そのまま残る |
| 申請の表示 | レビュワー/管理者は引き続き確認可能 |

## ロールの説明

### staff（スタッフ）

- シフト申請の作成・編集・取り下げ
- 自分の申請履歴の確認

### reviewer（レビュワー）

- シフト申請の承認・変更承認・却下
- 代理申請の作成
- スタッフ別の申請確認

### admin（管理者）

- レビュワーのすべての機能
- ユーザーの追加・編集
- ユーザーの有効/無効管理

## 申請タイプの説明

### fix（固定シフト）

- 特定の日時でシフトを申請
- 開始時刻と終了時刻を指定

### flex（フレックスシフト）

- 週単位で希望時間を申請
- 対象週と希望時間数を指定

## API 仕様

ユーザー管理は `/api/admin/users` API を通じて実行されます。

### 認可

- Bearer トークンによる認証
- admin ロールの確認

### エンドポイント

| メソッド | 用途 |
|---------|------|
| POST | ユーザー作成 |
| PATCH | ユーザー更新 |

## ベストプラクティス

### 1. ロールの適切な割り当て
- 必要最小限の権限を付与
- admin は限られた人数に

### 2. 無効化の使用
- 退職者は削除ではなく無効化
- 履歴の整合性を維持

### 3. 定期的な棚卸し
- 不要なアカウントを確認
- 権限の見直し

## 注意事項

### 自分自身の編集
- 管理者は自分自身のロールを変更可能
- ロールを変更すると管理画面にアクセスできなくなる可能性

### メールアドレスの変更
- 変更後は新しいメールアドレスでログイン
- 既存のセッションは維持される

### 削除機能
- 現在のバージョンではユーザー削除機能はありません
- 無効化で対応してください

## 関連ドキュメント

- [対象ユーザー](../00-introduction/03-target-users.md)
- [認証・認可](../02-architecture/04-auth.md)
- [管理 API](../05-api/04-admin-api.md)
